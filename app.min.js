(function(){const e="https://lutetia-api-little-sea-4696.fly.dev/decompile",t="https://api.etherscan.io/v2/api",n=(function(){try{return atob("Rlk2S0Y5QlpOVjJFMzlVVkhWNjY2OENLOThYNlRCVlQzVw==")}catch(e){return""}})(),o=document.querySelectorAll(".tab"),r=document.getElementById("panel-address"),a=document.getElementById("panel-paste"),l=document.getElementById("contract-address"),c=document.getElementById("chain"),d=document.getElementById("etherscan-apikey"),s=document.getElementById("bytecode-paste"),u=document.getElementById("btn-decompile"),p=document.getElementById("status"),m=document.getElementById("output-section"),h=document.getElementById("output-code"),g=document.getElementById("btn-copy");function f(e,t){p.textContent=e;p.className="status"+(t?" "+t:"")}function v(e){if(!e||"string"!=typeof e)return"";const t=e.trim().replace(/^0x/i,"");return/^[0-9a-fA-F]+$/.test(t)?t:""}function b(){const e=s.value.trim(),t=v(e);return t?t:null}function y(e,t,n){const o=e.trim().replace(/^0x/i,"");if(!/^[0-9a-fA-F]{40}$/.test(o))return Promise.reject(new Error("Invalid contract address"));const r=new URLSearchParams({chainid:String(t),module:"proxy",action:"eth_getCode",address:"0x"+o,tag:"latest"});return n&&r.set("apikey",n),fetch(t+"?"+r.toString()).then(e=>e.json()).then(e=>{if(e.error)return Promise.reject(new Error(e.error.message||"Etherscan error"));const t=e.result;if(!t||"string"!=typeof t)return Promise.reject(new Error("No bytecode returned"));const n=v(t);return n?n:Promise.reject(new Error("Invalid bytecode from chain"))})}function w(B){return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bytecode:B})}).then(e=>{if(!e.ok)throw new Error("Decompile request failed: "+e.status);return e.text()}).then(e=>{try{return JSON.parse(e)}catch(e){return{output:e}}}).then(e=>{if(e.error)throw new Error(e.error);return e.output!=null?String(e.output):""})}function x(e){h.textContent=e||"(no output)";m.classList.remove("hidden");h.parentElement.classList.remove("language-python");h.parentElement.classList.add("language-python");hljs.highlightElement(h)}o.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-tab");o.forEach(e=>e.classList.remove("active"));this.classList.add("active");r.classList.toggle("active",e==="address");a.classList.toggle("active",e==="paste");f("")})});u.addEventListener("click",function(){f("");const t=document.querySelector(".tab.active").getAttribute("data-tab")==="address";let o;if(t){const e=l.value.trim();if(!e)return f("Enter a contract address.","error");f("Fetching bytecode from chain…");o=y(e,c.value,d.value.trim()||n)}else{const e=b();if(!e)return f("Paste valid hex bytecode.","error");o=Promise.resolve(e)}u.disabled=!0;o.then(e=>{f("Decompiling…");return w(e)}).then(e=>{f("Done.","success");x(e)}).catch(e=>{f(e.message||"Error","error")}).finally(()=>{u.disabled=!1})});g.addEventListener("click",function(){const e=h.textContent;if(!e)return;navigator.clipboard.writeText(e).then(()=>{const e=g.textContent;g.textContent="Copied";setTimeout(()=>{g.textContent=e},1500)},()=>{})})})();
