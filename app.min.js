!function(){const e=function(){try{return atob("Rlk2S0Y5QlpOVjJFMzlVVkhWNjY2OENLOThYNlRCVlQzVw==")}catch(e){return""}}(),t=document.querySelectorAll(".tab"),r=document.getElementById("panel-address"),n=document.getElementById("panel-paste"),o=document.getElementById("contract-address"),s=document.getElementById("chain"),c=document.getElementById("etherscan-apikey"),a=document.getElementById("bytecode-paste"),i=document.getElementById("btn-decompile"),d=document.getElementById("status"),u=document.getElementById("output-section"),l=document.getElementById("output-code"),m=document.getElementById("btn-copy");function h(e,t){d.textContent=e,d.className="status"+(t?" "+t:"")}function p(e){if(!e||"string"!=typeof e)return"";const t=e.trim().replace(/^0x/i,"");return/^[0-9a-fA-F]+$/.test(t)?t:""}const f={1:"https://eth.llamarpc.com",11155111:"https://rpc.ankr.com/eth_sepolia"};function g(e,t,r){const n=e.trim().replace(/^0x/i,"");if(!/^[0-9a-fA-F]{40}$/.test(n))return Promise.reject(new Error("Invalid contract address"));const o=new URLSearchParams({chainid:String(t),module:"proxy",action:"eth_getCode",address:"0x"+n,tag:"latest"});r&&o.set("apikey",r);const s="https://api.etherscan.io/v2/api?"+o.toString();return fetch(s).then(e=>e.json()).then(e=>{if(e.error)return Promise.reject(new Error(e.error.message||"Etherscan error"));if("0"===e.status&&"NOTOK"===e.message)return Promise.reject(new Error(e.result||"Etherscan API error"));const t=e.result;if(!t||"string"!=typeof t)return Promise.reject(new Error("No bytecode returned"));const r=p(t);return r||Promise.reject(new Error("Invalid bytecode from chain"))}).catch(e=>{const r=f[Number(t)];return r?function(e,t){const r=t.startsWith("0x")?t:"0x"+t;return fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",id:1,method:"eth_getCode",params:[r,"latest"]})}).then(e=>e.json()).then(e=>{if(e.error)return Promise.reject(new Error(e.error.message||"RPC error"));const t=e.result;if(null==t||"string"!=typeof t)return Promise.reject(new Error("No bytecode from RPC"));return p(t)||Promise.reject(new Error("Invalid bytecode from chain"))})}(r,"0x"+n):Promise.reject(e)})}t.forEach(e=>{e.addEventListener("click",function(){const e=this.getAttribute("data-tab");t.forEach(e=>e.classList.remove("active")),this.classList.add("active"),r.classList.toggle("active","address"===e),n.classList.toggle("active","paste"===e),h("")})}),i.addEventListener("click",function(){h("");const t=Date.now();let r;if("address"===document.querySelector(".tab.active").getAttribute("data-tab")){const t=o.value.trim();if(!t)return void h("Enter a contract address.","error");h("Fetching bytecode from chain…"),r=g(t,s.value,c.value.trim()||e)}else{const e=function(){const e=p(a.value.trim());return e||null}();if(!e)return void h("Paste valid hex bytecode.","error");r=Promise.resolve(e)}i.disabled=!0,r.then(e=>(h("Decompiling…"),function(e){return fetch("https://lutetia-api-little-sea-4696.fly.dev/decompile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({bytecode:e})}).then(e=>{if(!e.ok)throw new Error("Decompile request failed: "+e.status);return e.text()}).then(e=>{try{return JSON.parse(e)}catch(t){return{output:e}}}).then(e=>{if(e.error)throw new Error(e.error);return null!=e.output?String(e.output):""})}(e))).then(e=>{h("Done. "+((Date.now()-t)/1e3).toFixed(2)+" s","success"),function(e){const t=e?"# Lutetia EVM Decompiler\n\n"+e:"(no output)";l.textContent=t,u.classList.remove("hidden"),l.parentElement.classList.remove("language-python"),l.parentElement.classList.add("language-python"),hljs.highlightElement(l)}(e)}).catch(e=>{h(e.message||"Error","error")}).finally(()=>{i.disabled=!1})}),m.addEventListener("click",function(){const e=l.textContent;e&&navigator.clipboard.writeText(e).then(()=>{const e=m.textContent;m.textContent="Copied",setTimeout(()=>{m.textContent=e},1500)},()=>{})})}();